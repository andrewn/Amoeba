<html>
  <head>
    <title>Canvas tutorial</title>
	<script type="text/javascript" src="tweenedValue.js"></script>

      <script type="text/javascript">
        function draw(){
          var canvas = document.getElementById('tutorial');
          if (canvas.getContext){
            var ctx = canvas.getContext('2d');
            
            var n = 20;
            var angle = 2*Math.PI/n;
            var l = 35; // Handler length
            var rint = 50;
            var rext = 300;
            var debug = true;

            ctx.translate(400,400);
            
            // Genero los vértices
            var points = new Array();
            for (var i = 0; i<n; i++) {
              var r = (rext-rint)*Math.random()+rint;
              points.push(r);
            }
            
            // Dibujo la forma
            ctx.beginPath();
            ctx.moveTo(0, points[0]);
            for (var i = 1; i<n; i++) {
              ctx.rotate(angle);
              var r1 = points[i-1];
              var r2 = points[i];
              var h1x = r1*Math.sin(angle)-l*Math.cos(angle);
              var h1y = r1*Math.cos(angle)+l*Math.sin(angle);
              var h2x = l;
              var h2y = r2;
              var px = 0;
              var py = r2;
              ctx.bezierCurveTo(h1x,h1y,h2x,h2y,px,py);
            }
            ctx.rotate(angle);
            var r1 = points[n-1];
            var r2 = points[0];
            ctx.bezierCurveTo(r1*Math.sin(angle)-l*Math.cos(angle),r1*Math.cos(angle)+l*Math.sin(angle),l,r2,0,r2);
            ctx.strokeStyle = "#FF0000";
            ctx.fillStyle = "#FFCC00";
            ctx.fill();


            if (debug) {
              
              console.log("debugando");
              
            // Dibujo los vértices y los handlers
            for (var i = 0; i<n; i++) {
              
              ctx.beginPath();
              ctx.fillStyle = "#CCCCCC";
              var r = points[i];
              ctx.arc(0,r,3,0,2*Math.PI,false);
              ctx.fill();

              ctx.beginPath();
              ctx.strokeStyle = "#FF9999";                            
              ctx.moveTo(-l,r);
              ctx.lineTo(l,r);
              ctx.stroke();


              ctx.rotate(angle);
              
            }
            
              // Dibujo el centro
              ctx.beginPath();
              ctx.strokeStyle = "#FFFFFF";              
              var r = points[i];
              ctx.moveTo(-5,-5);
              ctx.lineTo(5,5);
              ctx.moveTo(-5,5);
              ctx.lineTo(5,-5);
              ctx.stroke();


            
            }
            



            ctx.translate(-400,-400);
          }
          
          
          
          
        }
      </script>

      <style type="text/css">
        canvas { border: 1px solid black; }
      </style>
    </head>

    <body onload="draw();">
      <canvas id="tutorial" width="800" height="800"></canvas>
    </body>
</html>